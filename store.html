<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="google-site-verification" content="a1gTeDqTxL4UpnD6S760jfikJt132lz1FKjNOh60OWw" />
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5CCGD9G2');</script>
    <!-- End Google Tag Manager -->

    <meta charset="utf-8">
    <title>HBEE INNOVATIONS — Store</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <!-- Favicon + Fonts + Icons (kept from original) -->
    <link href="img/HBEE Favicon.png" rel="icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500&family=Nunito:wght@600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <style>
        /* small local tweaks for the store layout */
        .product-img { height: 220px; object-fit: cover; }
        .section-title { display:inline-block; padding: .25rem .75rem; border-radius: .5rem; background:#fff; color:#2874a6; font-weight:600; }
        .cart-badge { position:relative; top:-3px; }
        .cart-item-qty { width:70px; }
    </style>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5CCGD9G2"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<!-- Topbar / Brand / Navbar (kept from original, trimmed content) -->
<div class="container-fluid bg-light px-0">
    <div class="row gx-0 align-items-center d-none d-lg-flex">
        <div class="col-lg-6 px-5 text-start">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a class="small text-secondary" href="index.html">Home</a></li>
                <li class="breadcrumb-item"><a class="small text-secondary" href="contact.html">Contact</a></li>
            </ol>
        </div>
        <div class="col-lg-6 px-5 text-end">
            <small>Follow us:</small>
            <div class="h-100 d-inline-flex align-items-center">
                <a class="btn-square text-primary border-end rounded-0" href="#" target="_blank"><i class="fab fa-facebook-f"></i></a>
                <a class="btn-square text-primary border-end rounded-0" href="#"><i class="fab fa-twitter"></i></a>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid py-2 px-5">
    <div class="row align-items-center top-bar">
        <div class="col-lg-4 col-md-12 text-center text-lg-start d-flex align-items-center">
            <a href="index.html"><img src="img/HB logo and Line.png" alt="Logo" style="width:300px; height:auto;"></a>
        </div>
        <div class="col-lg-8 d-none d-lg-block">
            <div class="row">
                <div class="col-4 text-end"><p class="mb-0">Mon - Fri, 9:30 - 18:30</p></div>
                <div class="col-4 text-end"><p class="mb-0"><a href="tel:+918310099233">+91 83100 99233</a></p></div>
                <div class="col-4 text-end"><p class="mb-0"><a href="mailto:admin@hbeei.com">admin@hbeei.com</a></p></div>
            </div>
        </div>
    </div>
</div>

<nav class="navbar navbar-expand-lg bg-primary navbar-dark sticky-top py-lg-0 px-lg-5">
    <a class="navbar-brand d-lg-none" href="#">HBEE</a>
    <div class="container">
        <a class="navbar-brand d-none d-lg-block" href="index.html">HBEE Innovations</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navMenu">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="services.html">Services</a></li>
                <li class="nav-item"><a class="nav-link active" href="store.html">Store</a></li>
                <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
            </ul>
            <div class="d-flex align-items-center">
                <button class="btn btn-outline-light me-2" id="viewCartBtn" data-bs-toggle="modal" data-bs-target="#cartModal">
                    <i class="fa fa-shopping-cart"></i> Cart <span class="badge bg-danger cart-badge" id="cartCount">0</span>
                </button>
                <a href="contact.html" class="btn btn-sm btn-outline-light rounded-pill">Contact Us</a>
            </div>
        </div>
    </div>
</nav>

<!-- Hero (replaces carousel) -->
<div class="container-xxl py-4">
    <div class="container text-center">
        <h6 class="section-title">Welcome to Our Store</h6>
        <h1 class="mt-3">Agriculture Chemicals & Inputs</h1>
        <p class="lead">Seeds, fertilizers, crop protection, adjuvants — quality inputs for better yields.</p>
    </div>
</div>

<!-- Filters + Products -->
<div class="container py-4">
    <div class="row mb-3">
        <div class="col-md-4">
            <select id="categoryFilter" class="form-select">
                <option value="all">All Categories</option>
                <option value="fertilizer">Fertilizers</option>
                <option value="pesticide">Pesticides</option>
                <option value="seeds">Seeds</option>
                <option value="adjuvant">Adjuvants</option>
            </select>
        </div>
        <div class="col-md-8 text-end">
            <input id="searchInput" class="form-control d-inline-block w-50" placeholder="Search products...">
        </div>
    </div>

    <div class="row g-4" id="productsRow">
        <!-- products injected by JS -->
    </div>
</div>

<!-- Cart Modal -->
<div class="modal fade" id="cartModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fa fa-shopping-cart"></i> Your Cart</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="cartItems"></div>
        <div class="mt-3 text-end">
            <h5>Total: <span id="cartTotal">₹0</span></h5>
        </div>
      </div>
      <div class="modal-footer">
        <button id="clearCartBtn" class="btn btn-secondary">Clear</button>
        <button id="checkoutMailBtn" class="btn btn-primary">Checkout via Email</button>
        <button id="checkoutLinkBtn" class="btn btn-success">Proceed to Payment Link</button>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="bg-dark text-light py-4 mt-5">
    <div class="container text-center">
        &copy; 2025 HBEE Innovations. All rights reserved.
    </div>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/*
  Simple e‑commerce front-end:
  - Products are loaded from /products.json when available; otherwise the built-in fallback list is used.
  - Add to cart, cart persistence (localStorage), search & filter
  - Buy Now opens product.paymentLink (placeholder). Checkout via email composes order to support@hbeei.com
*/

let PRODUCTS = [];
const PRODUCTS_FALLBACK = [
  {
    id: 'fert-01',
    name: 'NPK Granules 20-20-20',
    category: 'fertilizer',
    image: 'https://images.unsplash.com/photo-1587560699334-6b0b1f0e6f02?auto=format&fit=crop&w=800&q=80',
    variants: [{key:'50kg', label:'50 kg', price: 2000},{key:'25kg', label:'25 kg', price: 1050}],
    paymentLink: 'https://buy.stripe.com/test_fert01'
  },
  {
    id: 'pest-01',
    name: 'CropGuard Insecticide (250ml)',
    category: 'pesticide',
    image: 'https://images.unsplash.com/photo-1581091012184-7a3d49b5f663?auto=format&fit=crop&w=800&q=80',
    variants: [{key:'250ml', label:'250 ml', price: 350}],
    paymentLink: 'https://buy.stripe.com/test_pest01'
  },
  {
    id: 'seed-01',
    name: 'Hybrid Maize Seeds (1kg)',
    category: 'seeds',
    image: 'https://images.unsplash.com/photo-1568605114967-8130f3a36994?auto=format&fit=crop&w=800&q=80',
    variants: [{key:'1kg', label:'1 kg', price: 420}],
    paymentLink: 'https://buy.stripe.com/test_seed01'
  },
  {
    id: 'adj-01',
    name: 'Spray Adjuvant (1L)',
    category: 'adjuvant',
    image: 'https://images.unsplash.com/photo-1524594154902-e4d9d5f8f2e0?auto=format&fit=crop&w=800&q=80',
    variants: [{key:'1L', label:'1 L', price: 250}],
    paymentLink: 'https://buy.stripe.com/test_adj01'
  },
  {
    id: 'mango-01',
    name: 'Organic Mango (Premium)',
    category: 'seeds',
    image: 'https://images.unsplash.com/photo-1502741338009-cac2772e18bc?auto=format&fit=crop&w=800&q=80',
    variants: [{key:'1kg', label:'1 kg', price: 180}],
    paymentLink: 'https://buy.stripe.com/test_mango01'
  }
];

async function loadProducts(){
  try{
    const resp = await fetch('/products.json', {cache: 'no-store'});
    if(resp.ok){
      PRODUCTS = await resp.json();
    } else {
      PRODUCTS = PRODUCTS_FALLBACK.slice();
    }
  }catch(e){
    PRODUCTS = PRODUCTS_FALLBACK.slice();
  }
  renderProducts(PRODUCTS);
  updateCartUI();
  applyFilters();
}

const CART_KEY = 'hbeei_cart_v1';
let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');

function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); updateCartUI(); }
function formatINR(n){ return '₹' + n.toLocaleString('en-IN'); }

function renderProducts(list){
  const row = document.getElementById('productsRow');
  row.innerHTML = '';
  list.forEach(p => {
    const col = document.createElement('div');
    col.className = 'col-lg-4 col-md-6';
    col.innerHTML = `
      <div class="card h-100 shadow-sm">
        <img src="${p.image}" class="card-img-top product-img" alt="${p.name}">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">${p.name}</h5>
          <p class="card-text text-muted">${p.category.charAt(0).toUpperCase()+p.category.slice(1)}</p>
          <div class="mb-2">
            <label class="form-label">Variant</label>
            <select class="form-select variant-select">
              ${p.variants.map(v=>`<option value="${v.key}" data-price="${v.price}">${v.label} - ${formatINR(v.price)}</option>`).join('')}
            </select>
          </div>
          <div class="mb-2 d-flex align-items-center">
            <label class="me-2 mb-0">Qty</label>
            <input type="number" class="form-control ms-auto qty-input" value="1" min="1" style="width:90px;">
          </div>
          <div class="mt-auto d-grid gap-2">
            <button class="btn btn-outline-primary add-cart-btn">Add to Cart</button>
            <button class="btn btn-primary buy-now-btn">Buy Now</button>
          </div>
        </div>
      </div>
    `;
    // actions
    col.querySelector('.add-cart-btn').addEventListener('click', () => {
      const variantKey = col.querySelector('.variant-select').value;
      const qty = parseInt(col.querySelector('.qty-input').value || '1', 10);
      addToCart(p.id, variantKey, qty);
      const bs = new bootstrap.Toast(document.createElement('div')); // silent
      updateCartUI();
    });
    col.querySelector('.buy-now-btn').addEventListener('click', () => {
      const variantSelect = col.querySelector('.variant-select');
      const variantKey = variantSelect.value;
      const variantPrice = parseFloat(variantSelect.selectedOptions[0].dataset.price || 0);
      const qty = parseInt(col.querySelector('.qty-input').value || '1', 10);
      // Open product paymentLink with quantity appended as query (placeholder). Replace with your real payment integration.
      const link = p.paymentLink + '?qty=' + qty + '&variant=' + encodeURIComponent(variantKey);
      window.open(link, '_blank');
    });

    row.appendChild(col);
  });
}

function addToCart(productId, variantKey, qty){
  qty = Number(qty);
  const itemIndex = cart.findIndex(it => it.productId === productId && it.variantKey === variantKey);
  if(itemIndex > -1) cart[itemIndex].qty += qty;
  else cart.push({ productId, variantKey, qty });
  saveCart();
}

function removeFromCart(index){ cart.splice(index,1); saveCart(); }
function updateQtyInCart(index, qty){ if(qty<1) qty=1; cart[index].qty = Number(qty); saveCart(); }

function updateCartUI(){
  document.getElementById('cartCount').textContent = cart.reduce((s,i)=>s+i.qty,0);
  const container = document.getElementById('cartItems');
  if(!container) return;
  container.innerHTML = '';
  let total = 0;
  if(cart.length === 0){ container.innerHTML = '<p class="text-muted">Your cart is empty.</p>'; }
  cart.forEach((it, idx) => {
    const prod = PRODUCTS.find(p=>p.id===it.productId);
    const variant = prod.variants.find(v=>v.key===it.variantKey) || prod.variants[0];
    const lineTotal = variant.price * it.qty;
    total += lineTotal;
    const row = document.createElement('div');
    row.className = 'd-flex align-items-center mb-3';
    row.innerHTML = `
      <img src="${prod.image}" style="width:80px;height:60px;object-fit:cover;border-radius:6px;margin-right:12px;">
      <div class="flex-grow-1">
        <strong>${prod.name}</strong><div class="text-muted small">${variant.label} — ${formatINR(variant.price)}</div>
      </div>
      <div class="text-end">
        <input type="number" class="form-control cart-item-qty mb-1" value="${it.qty}" min="1" data-idx="${idx}">
        <div class="small text-muted">${formatINR(lineTotal)}</div>
        <button class="btn btn-link text-danger btn-sm remove-item" data-idx="${idx}">Remove</button>
      </div>
    `;
    container.appendChild(row);
  });
  document.getElementById('cartTotal').textContent = formatINR(total);
  // bind qty & remove handlers
  document.querySelectorAll('.cart-item-qty').forEach(input => {
    input.addEventListener('change', e => updateQtyInCart(e.target.dataset.idx, e.target.value));
  });
  document.querySelectorAll('.remove-item').forEach(btn => {
    btn.addEventListener('click', e => removeFromCart(Number(e.target.dataset.idx)));
  });
}

document.getElementById('categoryFilter').addEventListener('change', applyFilters);
document.getElementById('searchInput').addEventListener('input', applyFilters);

function applyFilters(){
  const cat = document.getElementById('categoryFilter').value;
  const q = document.getElementById('searchInput').value.trim().toLowerCase();
  const filtered = PRODUCTS.filter(p => {
    if(cat !== 'all' && p.category !== cat) return false;
    if(q && !(p.name.toLowerCase().includes(q) || p.category.toLowerCase().includes(q))) return false;
    return true;
  });
  renderProducts(filtered);
}

// Clear cart
document.getElementById('clearCartBtn').addEventListener('click', () => { cart = []; saveCart(); });

// Checkout via email: prefill order to support@hbeei.com
document.getElementById('checkoutMailBtn').addEventListener('click', () => {
  if(cart.length === 0){ alert('Cart is empty'); return; }
  const lines = cart.map(it => {
    const prod = PRODUCTS.find(p=>p.id===it.productId);
    const variant = prod.variants.find(v=>v.key===it.variantKey) || prod.variants[0];
    return `${prod.name} — ${variant.label} — Qty: ${it.qty} — Price each: ${formatINR(variant.price)}`;
  });
  const total = cart.reduce((sum,it) => {
    const prod = PRODUCTS.find(p=>p.id===it.productId);
    const variant = prod.variants.find(v=>v.key===it.variantKey) || prod.variants[0];
    return sum + variant.price*it.qty;
  },0);
  const body = encodeURIComponent('Order details:%0A' + lines.join('%0A') + '%0A%0ATotal: ' + formatINR(total) + '%0A%0APlease send payment link and shipping options.%0A%0AName:%0APhone:%0AAddress:%0A');
  window.location.href = `mailto:admin@hbeei.com?subject=Store Order&body=${body}`;
});

// Checkout link: Redirect to a simple payment aggregator (placeholder) — you should replace with your real checkout integration
document.getElementById('checkoutLinkBtn').addEventListener('click', () => {
  if(cart.length === 0){ alert('Cart is empty'); return; }
  // build a summary to pass to your backend/payment gateway
  const summary = cart.map(it => {
    const prod = PRODUCTS.find(p=>p.id===it.productId);
    const variant = prod.variants.find(v=>v.key===it.variantKey) || prod.variants[0];
    return `${prod.id}:${variant.key}:${it.qty}`;
  }).join(',');
  // This URL is a placeholder: replace with your server endpoint that creates a payment session
  const url = '/create-checkout-session?items=' + encodeURIComponent(summary);
  // For now, inform the user — replace with actual redirect when backend available
  alert('Proceeding to payment — this will redirect to your checkout flow. (placeholder)\n\n' + url);
  // window.location.href = url;
});

// init: load products (from /products.json when present) then initialize UI
loadProducts();

</script>
</body>
</html>